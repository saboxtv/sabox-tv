<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>SABOX TV</title>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
*{box-sizing:border-box}

body{
margin:0;
background:#050505;
color:#fff;
font-family:system-ui;
overflow:hidden;
}

header{
background:#0f0f0f;
padding:14px;
text-align:center;
font-size:22px;
font-weight:600;
}

/* ===== LAYOUT ===== */

#wrap{
display:flex;
height:calc(100vh - 55px);
}

/* ===== CHANNEL LIST ===== */

#list{
width:330px;
background:#111;
overflow-y:auto;
padding:14px;
}

.channel{
background:#1c1c1c;
padding:16px;
margin-bottom:18px;
border-radius:14px;
display:flex;
justify-content:space-between;
cursor:pointer;
transition:.2s;
}

.channel:hover{background:#2b2b2b}
.active{background:#3b3b3b}

.star{color:#666}
.star.on{color:gold}

/* ===== PLAYER ===== */

#playerWrap{
flex:1;
display:flex;
justify-content:center;
align-items:center;
background:black;
padding:12px;
}

#playerBox{
width:100%;
max-width:1200px;
aspect-ratio:16/9;
background:black;
border-radius:16px;
overflow:hidden;
position:relative;
}

video{
width:100%;
height:100%;
object-fit:contain;
background:black;
}

/* PiP */

#pip{
position:absolute;
right:12px;
bottom:60px;
background:#000b;
color:white;
border:1px solid #555;
border-radius:10px;
padding:8px 12px;
cursor:pointer;
}

/* ================= MOBILE FIX ================= */

@media(max-width:900px){

#wrap{
flex-direction:column;
height:100vh;
}

#list{
width:100%;
height:42%;
padding:10px;
}

.channel{
padding:14px;
margin-bottom:14px;
font-size:15px;
}

#playerWrap{
height:58%;
padding:6px;
}

#playerBox{
border-radius:10px;
}

#pip{
bottom:10px;
right:10px;
padding:6px 10px;
font-size:13px;
}

header{
font-size:18px;
padding:10px;
}

}
</style>
</head>

<body>

<header>ðŸ“¡ SABOX TV</header>

<div id="wrap">

<div id="list"></div>

<div id="playerWrap">
<div id="playerBox">
<video id="video" controls autoplay playsinline></video>
<button id="pip">PiP</button>
</div>
</div>

</div>

<script>

/* =================================================
   ðŸ‘‰ ADD CHANNELS BELOW

   {
     name:"Channel Name",
     url:"M3U8_LINK"
   },

================================================= */

const channels=[

{
 name:"Star Jalsha HD",
 url:"http://103.151.60.204/ZAHIR_EN8_90_110_P1/tracks-v1a1/mono.m3u8"
},

{
 name:"Zee Bangla HD",
 url:"http://103.151.60.204/ZAHIR_EN8_90_110_P3/tracks-v1a1/mono.m3u8"
},

{
 name:"Sony Aath HD",
 url:"http://103.151.60.204/ZAHIR_EN8_90_110_P6/tracks-v1a1/mono.m3u8"
},

{
 name:"T-Sports",
 url:"http://103.151.60.204/T-Sports/tracks-v1a1/mono.m3u8"
}

];

/* ================= CORE ================= */

let hls;
let fav=JSON.parse(localStorage.getItem("fav")||"[]");
let userPaused=false;

const video=document.getElementById("video");
const list=document.getElementById("list");

/* ===== RENDER ===== */

function render(){

list.innerHTML="";

const order=[
 ...channels.filter(c=>fav.includes(c.name)),
 ...channels.filter(c=>!fav.includes(c.name))
];

order.forEach(c=>{

 const div=document.createElement("div");
 div.className="channel";

 div.innerHTML=`
 ${c.name}
 <span class="star ${fav.includes(c.name)?"on":""}">â˜…</span>
 `;

 div.onclick=()=>play(c.url,div);

 div.querySelector(".star").onclick=e=>{
  e.stopPropagation();
  toggleFav(c.name);
 };

 list.appendChild(div);
});

}

/* ===== FAVORITE ===== */

function toggleFav(n){
fav=fav.includes(n)?fav.filter(x=>x!==n):[n,...fav];
localStorage.setItem("fav",JSON.stringify(fav));
render();
}

/* ===== PLAY ===== */

function play(url,el){

userPaused=false;

document.querySelectorAll(".channel")
.forEach(x=>x.classList.remove("active"));
el.classList.add("active");

if(hls) hls.destroy();

if(Hls.isSupported()){
hls=new Hls({
 lowLatencyMode:true,
 maxBufferLength:15,
 liveSyncDuration:3
});
hls.loadSource(url);
hls.attachMedia(video);
}else{
video.src=url;
}

video.play().catch(()=>{});
}

/* ===== SMART AUTO RESUME ===== */

["pause","waiting","stalled"].forEach(e=>{
video.addEventListener(e,()=>{
 if(!userPaused) setTimeout(()=>video.play().catch(()=>{}),400);
});
});

video.addEventListener("leavepictureinpicture",()=>{
 if(!userPaused) video.play();
});

/* ===== PiP ===== */

document.getElementById("pip").onclick=async()=>{
if(document.pictureInPictureElement)
 document.exitPictureInPicture();
else
 await video.requestPictureInPicture();
};

/* ===== SHORTCUT ===== */

document.addEventListener("keydown",e=>{

switch(e.key.toLowerCase()){

 case " ":
 e.preventDefault();
 if(video.paused){
  userPaused=false;
  video.play();
 }else{
  userPaused=true;
  video.pause();
 }
 break;

 case "f":
 if(!document.fullscreenElement)
  document.getElementById("playerBox").requestFullscreen();
 else
  document.exitFullscreen();
 break;

 case "m":
 video.muted=!video.muted;
 break;

 case "arrowup":
 video.volume=Math.min(1,video.volume+.05);
 break;

 case "arrowdown":
 video.volume=Math.max(0,video.volume-.05);
 break;

}

});

/* ===== AUTO FIRST PLAY ===== */

render();
setTimeout(()=>document.querySelector(".channel")?.click(),500);

</script>
</body>
</html>
