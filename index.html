<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SABOX TV</title>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
*{box-sizing:border-box}

body{
margin:0;
background:#050505;
color:#fff;
font-family:system-ui;
overflow:hidden;
}

header{
background:#0f0f0f;
padding:14px;
text-align:center;
font-size:22px;
font-weight:600;
}

#wrap{
display:flex;
height:calc(100vh - 55px);
}

/* CHANNEL LIST */
#list{
width:320px;
background:#111;
overflow-y:auto;
padding:12px;
}

.channel{
background:#1c1c1c;
padding:14px;
margin-bottom:18px;
border-radius:14px;
display:flex;
justify-content:space-between;
cursor:pointer;
transition:.2s;
}

.channel:hover{background:#2b2b2b}
.active{background:#3b3b3b}

.star{color:#666}
.star.on{color:gold}

/* PLAYER */
#playerWrap{
flex:1;
display:flex;
justify-content:center;
align-items:center;
padding:10px;
}

#playerBox{
width:100%;
max-width:1100px;
aspect-ratio:16/9;
background:#000;
border-radius:16px;
overflow:hidden;
position:relative;
}

video{
width:100%;
height:100%;
object-fit:contain;
background:black;
}

/* PiP */
#pip{
position:absolute;
right:12px;
bottom:12px;
background:#000c;
color:white;
border:1px solid #555;
border-radius:10px;
padding:8px 12px;
cursor:pointer;
}

/* MOBILE */
@media(max-width:850px){
#wrap{flex-direction:column}
#list{
width:100%;
height:42%;
}
#playerWrap{
height:58%;
}
}
</style>
</head>

<body>

<header>ðŸ“¡ SABOX TV</header>

<div id="wrap">

<div id="list"></div>

<div id="playerWrap">
 <div id="playerBox">
  <video id="video" controls autoplay playsinline></video>
  <button id="pip">PiP</button>
 </div>
</div>

</div>

<script>

/* ===========================
   ADD CHANNELS HERE
   Keep spacing clean
=========================== */

const channels=[

{
 name:"Star Jalsha HD",
 url:"http://103.151.60.204/ZAHIR_EN8_90_110_P1/tracks-v1a1/mono.m3u8"
},

{
 name:"Zee Bangla HD",
 url:"http://103.151.60.204/ZAHIR_EN8_90_110_P3/tracks-v1a1/mono.m3u8"
},

{
 name:"Sony Aath HD",
 url:"http://103.151.60.204/ZAHIR_EN8_90_110_P6/tracks-v1a1/mono.m3u8"
},

{
 name:"T-Sports",
 url:"http://103.151.60.204/T-Sports/tracks-v1a1/mono.m3u8"
}

];

/* ================= CORE ================= */

const proxy="https://cors.isomorphic-git.org/";

let hls;
let fav=JSON.parse(localStorage.getItem("fav")||"[]");
let userPaused=false;

const video=document.getElementById("video");
const list=document.getElementById("list");

/* RENDER LIST */
function render(){

 list.innerHTML="";

 const order=[
  ...channels.filter(c=>fav.includes(c.name)),
  ...channels.filter(c=>!fav.includes(c.name))
 ];

 order.forEach(c=>{

  const div=document.createElement("div");
  div.className="channel";

  div.innerHTML=`
   ${c.name}
   <span class="star ${fav.includes(c.name)?"on":""}">â˜…</span>
  `;

  div.onclick=()=>play(c.url,div);

  div.querySelector(".star").onclick=e=>{
   e.stopPropagation();
   toggleFav(c.name);
  };

  list.appendChild(div);
 });
}

/* FAVORITE */
function toggleFav(n){
 fav=fav.includes(n)?fav.filter(x=>x!==n):[n,...fav];
 localStorage.setItem("fav",JSON.stringify(fav));
 render();
}

/* PLAY STREAM (NETLIFY SAFE) */
function play(url,el){

 userPaused=false;

 document.querySelectorAll(".channel")
 .forEach(x=>x.classList.remove("active"));
 el.classList.add("active");

 if(hls) hls.destroy();

 const stream=proxy+url;

 if(Hls.isSupported()){
  hls=new Hls({
   lowLatencyMode:true,
   maxBufferLength:15,
   liveSyncDuration:3
  });
  hls.loadSource(stream);
  hls.attachMedia(video);
 }else{
  video.src=stream;
 }

 video.play().catch(()=>{});
}

/* AUTO RESUME */
["pause","waiting","stalled"].forEach(e=>{
 video.addEventListener(e,()=>{
  if(!userPaused) setTimeout(()=>video.play().catch(()=>{}),400);
 });
});

video.addEventListener("leavepictureinpicture",()=>{
 if(!userPaused) video.play();
});

/* PiP */
document.getElementById("pip").onclick=async()=>{
 if(document.pictureInPictureElement)
  document.exitPictureInPicture();
 else
  await video.requestPictureInPicture();
};

/* KEYBOARD */
document.addEventListener("keydown",e=>{

 switch(e.key.toLowerCase()){

  case " ":
   e.preventDefault();
   if(video.paused){
    userPaused=false;
    video.play();
   }else{
    userPaused=true;
    video.pause();
   }
   break;

  case "f":
   if(!document.fullscreenElement)
    document.getElementById("playerBox").requestFullscreen();
   else
    document.exitFullscreen();
   break;

  case "m":
   video.muted=!video.muted;
   break;

  case "arrowup":
   video.volume=Math.min(1,video.volume+.05);
   break;

  case "arrowdown":
   video.volume=Math.max(0,video.volume-.05);
   break;

  case "arrowright":
   video.currentTime+=5;
   break;

  case "arrowleft":
   video.currentTime-=5;
   break;
 }
});

/* AUTO START */
render();
setTimeout(()=>document.querySelector(".channel")?.click(),600);

</script>
</body>
</html>
